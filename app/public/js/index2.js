import{c as e,r as t,j as n}from"./index.js";var o={},r=e&&e.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var o=Array(e),r=0,t=0;t<n;t++)for(var s=arguments[t],a=0,i=s.length;a<i;a++,r++)o[r]=s[a];return o};function s(e){var t=e.prototype&&e.prototype.constructor===e&&Object.getOwnPropertyNames(e.prototype).length>1,n=!t&&e.toString(),o;return t||/^function\s+[A-Z]/.test(n)||"class"===n.slice(0,5)}function a(e){return e&&"function"==typeof e&&!s(e)}Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e={}),this.multiMode=!1,this.eventListeners={},this.timeoutIds=[],this.intervalIds=[],this.propertyAdded={},this.originalValues={};var t=e.multiMode;window.Proxy||(console.warn("proxy sandbox is not support by current browser"),this.sandboxDisabled=!0),this.multiMode=t,this.sandbox=null}return e.prototype.createProxySandbox=function(e){var t=this,n=this,o=n.propertyAdded,s=n.originalValues,i=n.multiMode,c=Object.create(null),l=window,u=window.addEventListener,d=window.removeEventListener,p=window.setInterval,h=window.setTimeout;c.addEventListener=function(e,n){for(var o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];return t.eventListeners[e]=t.eventListeners[e]||[],t.eventListeners[e].push(n),u.apply(l,r([e,n],o))},c.removeEventListener=function(e,n){for(var o=[],s=2;s<arguments.length;s++)o[s-2]=arguments[s];var a=t.eventListeners[e]||[];return a.includes(n)&&a.splice(a.indexOf(n),1),d.apply(l,r([e,n],o))},c.setTimeout=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=h.apply(void 0,e);return t.timeoutIds.push(o),o},c.setInterval=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=p.apply(void 0,e);return t.intervalIds.push(o),o};var f=new Proxy(c,{set:function(e,t,n){return l.hasOwnProperty(t)?s.hasOwnProperty(t)||(s[t]=l[t]):o[t]=n,i||(l[t]=n),e[t]=n,!0},get:function(t,n){if(n!==Symbol.unscopables){if(["top","window","self","globalThis"].includes(n))return f;if("hasOwnProperty"===n)return function(e){return!!t[e]||l.hasOwnProperty(e)};var o=t[n];if(void 0!==o)return o;var r=e&&e[n];if(r)return r;var s=l[n];if("eval"===n)return s;if(a(s)){var i=s.bind(l);for(var c in s)i[c]=s[c];return i}return s}},has:function(e,t){return t in e||t in l}});this.sandbox=f},e.prototype.getSandbox=function(){return this.sandbox},e.prototype.getAddedProperties=function(){return this.propertyAdded},e.prototype.execScriptInSandbox=function(e){if(!this.sandboxDisabled){this.sandbox||this.createProxySandbox();try{var t,n;new Function("sandbox","with (sandbox) {;"+e+"\n}").bind(this.sandbox)(this.sandbox)}catch(o){throw console.error("error occurs when execute script in sandbox: "+o),o}}},e.prototype.clear=function(){var e=this;this.sandboxDisabled||(Object.keys(this.eventListeners).forEach((function(t){(e.eventListeners[t]||[]).forEach((function(e){window.removeEventListener(t,e)}))})),this.timeoutIds.forEach((function(e){return window.clearTimeout(e)})),this.intervalIds.forEach((function(e){return window.clearInterval(e)})),Object.keys(this.originalValues).forEach((function(t){window[t]=e.originalValues[t]})),Object.keys(this.propertyAdded).forEach((function(e){delete window[e]})))},e}(),c=o.default=i;let l,u,d,p=[];const h="undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("Trident");function f(e,t){return!t.hasOwnProperty(e)||!isNaN(e)&&e<t.length||h&&t[e]&&"undefined"!=typeof window&&t[e].parent===window}function m(e){let t=0,n;for(const o in e)if(!f(o,e)){if(0===t&&o!==l||1===t&&o!==u)return o;t++,n=o}if(n!==d)return n;for(const o in e)p.includes(o)||(n=o);return n}function w(e){l=void 0,u=void 0,p=Object.keys(e);for(const t in e)f(t,e)||(l?u||(u=t):l=t,d=t);return d}class y{constructor(){this.importTask={}}load(e,t=window.fetch){const{url:n,name:o}=e;if(this.importTask[o])return this.importTask[o];const r=Array.isArray(n)?n:[n],s=Promise.all(r.map((e=>t(e).then((e=>e.text())).then((t=>`${t} \n //# sourceURL=${e}`)))));return this.importTask[o]=s,s}removeTask(e){delete this.importTask[e]}clearTask(){this.importTask={}}execModule(e,t,n){return this.load(e).then((o=>{let r=null;(null==t?void 0:t.getSandbox)?(t.createProxySandbox(n),r=t.getSandbox(),console.log("globalWindow>>",r)):r=window;const{name:s}=e;let a="";try{o.forEach(((e,n)=>{const s=n===o.length-1;s&&w(r),(null==t?void 0:t.execScriptInSandbox)?t.execScriptInSandbox(e):(0,eval)(e),s&&(a=m(r))}))}catch(c){console.error(c)}const i=a?r[a]:r[s]||{};return r[a]&&delete r[a],i}))}}const v=e=>Array.isArray(e)?e:[e];!function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:null};const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}window.CustomEvent=e}();const g={};function x(e,t,n=new c({multiMode:!0})){n.createProxySandbox(t),v(e).forEach((e=>n.execScriptInSandbox(e)));const o=n.getAddedProperties();return n.clear(),o}function b(e,t){g[e]||(g[e]={}),g[e].state=t}async function E(e,t,n=window.fetch){var o,r,s;const{id:a,url:i}=e,c=a;if("LOADING"===(null==(o=g[c])?void 0:o.state)&&await new Promise((e=>window.addEventListener(c,e))),"LOADED"===(null==(r=g[c])?void 0:r.state))return null==(s=g[c])?void 0:s.deps;b(c,"LOADING");const{cssList:l,jsList:u}=$(i);Promise.all(l.map((e=>R(`runtime-${a}`,e))));try{return g[c].deps=await Promise.all(u.map((e=>n(e).then((e=>e.text()))))).then((e=>x(e,t))),b(c,"LOADED"),window.dispatchEvent(new CustomEvent(c,{detail:{state:"LOADED"}})),g[c].deps}catch(d){return b(c,"LOAD_ERROR"),window.dispatchEvent(new CustomEvent(c,{detail:{state:"LOAD_ERROR"}})),console.error(`[icestark module] ${a} fetch or excute js assets error`,d),Promise.reject(d)}}function C(e,t=window.fetch){return/.json/.test(e)||console.warn("[icestark-module] runtime url should be a json file."),t(e).then((e=>e.json()))}async function A(e,t=window.fetch){return await e.reduce((async(e,n)=>{const o=await e;return{...o,...await E(n,o,t)}}),Promise.resolve({}))}async function L(e,t=window.fetch){if(!e)return null;if("string"==typeof e){const n=undefined;return A(await C(e,t))}return Array.isArray(e)?A(e):void 0}let j={};const I={},S=/\.css(\?((?!\.js$).)+)?$/,k=new y,O=e=>(e||[]).filter((e=>I[e]?(I[e]+=1,!1):(I[e]=1,!0))),P=e=>(e||[]).filter((e=>I[e]>1?(I[e]-=1,!1):(delete I[e],!0)));function N(e,t){let n=null;if(t||e)if(e)if("function"==typeof e)n=new e;else{const t=undefined;n=new c("boolean"==typeof e?{}:e)}else n=new c;return n}const $=e=>{const t=[],n=[];return(Array.isArray(e)?e:[e]).forEach((e=>{const o=undefined;S.test(e)?n.push(e):t.push(e)})),{jsList:t,cssList:n}};function R(e,t,n=document.getElementsByTagName("head")[0]){return new Promise(((o,r)=>{n||r(new Error(`no root element for css assert: ${t}`));const s=document.createElement("link");s.setAttribute("module",e),s.rel="stylesheet",s.href=t,s.addEventListener("error",(()=>(console.error(`css asset loaded error: ${t}`),o())),!1),s.addEventListener("load",(()=>o()),!1),n.appendChild(s)}))}function T(e,t,n){const o=undefined;(t||document).querySelectorAll(`link[module=${e}]`).forEach((e=>{(n&&n.includes(e.getAttribute("href"))||!n)&&e.parentNode.removeChild(e)}))}const U=async(e,t)=>{const{name:n,url:o,runtime:r}=e;let s=null;if(!j[n]){let e=null;r&&(e=await L(r));const{jsList:a,cssList:i}=$(o);s=N(t,e);const c=await k.execModule({name:n,url:a},s,e);j[n]={moduleInfo:c,moduleSandbox:s,moduleCSS:i},console.log("moduleInfo",c)}const{moduleInfo:a,moduleCSS:i}=j[n];if(!a){const e="load or exec module faild";return console.error(e),Promise.reject(new Error(e))}const c=e.mount||(null==a?void 0:a.mount),l=e.unmount||(null==a?void 0:a.unmount),u=a.default||a;c&&l||console.error("[icestark module] Please export mount/unmount function");const d=O(i);return d.length&&await Promise.all(d.map((e=>R(n,e)))),void 0!==a.component&&console.warn("[icestark module] The export function name called component is conflict, please change it or it will be ignored."),{...a,mount:c,unmount:l,component:u}},D=async(e,t,n={},o)=>{const{mount:r,component:s}=await U(e,o);return r(s,t,n)},q=(e,t)=>{var n,o,r;const{name:s}=e,a=null==(n=j[s])?void 0:n.moduleInfo,i=null==(o=j[s])?void 0:o.moduleSandbox,c=e.unmount||(null==a?void 0:a.unmount),l=P(null==(r=j[s])?void 0:r.moduleCSS);if(T(s,document,l),(null==i?void 0:i.clear)&&i.clear(),c&&t)return c(t)};var M=function e(t,n){if(n=n.split(":")[0],!(t=+t))return!1;switch(n){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t},B={},_=Object.prototype.hasOwnProperty,z;function V(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return null}}function Z(e){try{return encodeURIComponent(e)}catch(t){return null}}function F(e){for(var t=/([^=?#&]+)=?([^&]*)/g,n={},o;o=t.exec(e);){var r=V(o[1]),s=V(o[2]);null===r||null===s||r in n||(n[r]=s)}return n}function G(e,t){t=t||"";var n=[],o,r;for(r in"string"!=typeof t&&(t="?"),e)if(_.call(e,r)){if((o=e[r])||null!==o&&o!==z&&!isNaN(o)||(o=""),r=Z(r),o=Z(o),null===r||null===o)continue;n.push(r+"="+o)}return n.length?t+n.join("&"):""}B.stringify=G,B.parse=F;var K=M,W=B,H=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,J=/[\n\r\t]/g,Q=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,X=/:\d+$/,Y=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,ee=/^[a-zA-Z]:/;function te(e){return(e||"").toString().replace(H,"")}var ne=[["#","hash"],["?","query"],function e(t,n){return se(n.protocol)?t.replace(/\\/g,"/"):t},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],oe={hash:1,query:1};function re(t){var n,o=(n="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{}).location||{},r={},s=typeof(t=t||o),a;if("blob:"===t.protocol)r=new ce(unescape(t.pathname),{});else if("string"===s)for(a in r=new ce(t,{}),oe)delete r[a];else if("object"===s){for(a in t)a in oe||(r[a]=t[a]);void 0===r.slashes&&(r.slashes=Q.test(t.href))}return r}function se(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function ae(e,t){e=(e=te(e)).replace(J,""),t=t||{};var n=Y.exec(e),o=n[1]?n[1].toLowerCase():"",r=!!n[2],s=!!n[3],a=0,i;return r?s?(i=n[2]+n[3]+n[4],a=n[2].length+n[3].length):(i=n[2]+n[4],a=n[2].length):s?(i=n[3]+n[4],a=n[3].length):i=n[4],"file:"===o?a>=2&&(i=i.slice(2)):se(o)?i=n[4]:o?r&&(i=i.slice(2)):a>=2&&se(t.protocol)&&(i=n[4]),{protocol:o,slashes:r||se(o),slashesCount:a,rest:i}}function ie(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),o=n.length,r=n[o-1],s=!1,a=0;o--;)"."===n[o]?n.splice(o,1):".."===n[o]?(n.splice(o,1),a++):a&&(0===o&&(s=!0),n.splice(o,1),a--);return s&&n.unshift(""),"."!==r&&".."!==r||n.push(""),n.join("/")}function ce(e,t,n){if(e=(e=te(e)).replace(J,""),!(this instanceof ce))return new ce(e,t,n);var o,r,s,a,i,c,l=ne.slice(),u=typeof t,d=this,p=0;for("object"!==u&&"string"!==u&&(n=t,t=null),n&&"function"!=typeof n&&(n=W.parse),o=!(r=ae(e||"",t=re(t))).protocol&&!r.slashes,d.slashes=r.slashes||o&&t.slashes,d.protocol=r.protocol||t.protocol||"",e=r.rest,("file:"===r.protocol&&(2!==r.slashesCount||ee.test(e))||!r.slashes&&(r.protocol||r.slashesCount<2||!se(d.protocol)))&&(l[3]=[/(.*)/,"pathname"]);p<l.length;p++)"function"!=typeof(a=l[p])?(s=a[0],c=a[1],s!=s?d[c]=e:"string"==typeof s?~(i="@"===s?e.lastIndexOf(s):e.indexOf(s))&&("number"==typeof a[2]?(d[c]=e.slice(0,i),e=e.slice(i+a[2])):(d[c]=e.slice(i),e=e.slice(0,i))):(i=s.exec(e))&&(d[c]=i[1],e=e.slice(0,i.index)),d[c]=d[c]||o&&a[3]&&t[c]||"",a[4]&&(d[c]=d[c].toLowerCase())):e=a(e,d);n&&(d.query=n(d.query)),o&&t.slashes&&"/"!==d.pathname.charAt(0)&&(""!==d.pathname||""!==t.pathname)&&(d.pathname=ie(d.pathname,t.pathname)),"/"!==d.pathname.charAt(0)&&se(d.protocol)&&(d.pathname="/"+d.pathname),K(d.port,d.protocol)||(d.host=d.hostname,d.port=""),d.username=d.password="",d.auth&&(~(i=d.auth.indexOf(":"))?(d.username=d.auth.slice(0,i),d.username=encodeURIComponent(decodeURIComponent(d.username)),d.password=d.auth.slice(i+1),d.password=encodeURIComponent(decodeURIComponent(d.password))):d.username=encodeURIComponent(decodeURIComponent(d.auth)),d.auth=d.password?d.username+":"+d.password:d.username),d.origin="file:"!==d.protocol&&se(d.protocol)&&d.host?d.protocol+"//"+d.host:"null",d.href=d.toString()}function le(e,t,n){var o=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||W.parse)(t)),o[e]=t;break;case"port":o[e]=t,K(t,o.protocol)?t&&(o.host=o.hostname+":"+t):(o.host=o.hostname,o[e]="");break;case"hostname":o[e]=t,o.port&&(t+=":"+o.port),o.host=t;break;case"host":o[e]=t,X.test(t)?(t=t.split(":"),o.port=t.pop(),o.hostname=t.join(":")):(o.hostname=t,o.port="");break;case"protocol":o.protocol=t.toLowerCase(),o.slashes=!n;break;case"pathname":case"hash":if(t){var r="pathname"===e?"/":"#";o[e]=t.charAt(0)!==r?r+t:t}else o[e]=t;break;case"username":case"password":o[e]=encodeURIComponent(t);break;case"auth":var s=t.indexOf(":");~s?(o.username=t.slice(0,s),o.username=encodeURIComponent(decodeURIComponent(o.username)),o.password=t.slice(s+1),o.password=encodeURIComponent(decodeURIComponent(o.password))):o.username=encodeURIComponent(decodeURIComponent(t))}for(var a=0;a<ne.length;a++){var i=ne[a];i[4]&&(o[i[1]]=o[i[1]].toLowerCase())}return o.auth=o.password?o.username+":"+o.password:o.username,o.origin="file:"!==o.protocol&&se(o.protocol)&&o.host?o.protocol+"//"+o.host:"null",o.href=o.toString(),o}function ue(e){e&&"function"==typeof e||(e=W.stringify);var t,n=this,o=n.host,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var s=r+(n.protocol&&n.slashes||se(n.protocol)?"//":"");return n.username?(s+=n.username,n.password&&(s+=":"+n.password),s+="@"):n.password?(s+=":"+n.password,s+="@"):"file:"!==n.protocol&&se(n.protocol)&&!o&&"/"!==n.pathname&&(s+="@"),(":"===o[o.length-1]||X.test(n.hostname)&&!n.port)&&(o+=":"),s+=o+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(s+=n.hash),s}ce.prototype={set:le,toString:ue},ce.extractProtocol=ae,ce.location=re,ce.trimLeft=te,ce.qs=W;var de=ce;const pe={info:console.log,error:console.error,warn:console.warn},he=/<!--.*?-->/g,fe=/<base\s[^>]*href=['"]?([^'"]*)['"]?[^>]*>/,me="",we="stylesheet",ye={},ve=null==window?void 0:window.fetch.bind(window);function ge(e){const{origin:t,pathname:n}=de(e);return{origin:t,pathname:n}}function xe(e,t){return e.slice(0,t.length)===t}function be(e,t){const{origin:n,pathname:o}=ge(e);if(xe(t,"./")){const e=t.slice(1);if(!o||"/"===o)return`${n}${e}`;const r=o.split("/");return r.splice(-1),`${n}${r.join("/")}${e}`}return xe(t,"/")?`${n}${t}`:`${n}/${t}`}function Ee(e,t,n){return`${e} ${t} ${n} by @ice/stark`}function Ce(e){return/^(https?:)?\/\/.+/.test(e)}function Ae(e,t){if(null==e?void 0:e.parentNode){const n=document.createComment(t);e.parentNode.appendChild(n),e.parentNode.removeChild(e)}}function Le(e,t){let n=e;const o=/import\s+?(?:(?:(?:[\w*\s{},]*)\s+from\s+?)|)(?:(?:"(.*?)")|(?:'(.*?)'))[\s]*?(?:;|$|)/,r=e.match(new RegExp(o,"g"));return r&&r.forEach((r=>{const[,s,a]=r.match(o),i=s||a;if(!Ce(i)){const o=be(t,i),s=r.replace(i,o);n=e.replace(r,s)}})),n}function je(e,t){var n;if(!e)return{html:document.createElement("div"),assets:{cssList:[],jsList:[]}};const o=(new DOMParser).parseFromString(e.replace(he,""),"text/html");if(t){const n=e.match(fe),r=o.getElementsByTagName("base"),s=r.length>0;if(n&&s){const e=r[0],[,o]=n;e.href=Ce(o)?o:be(t,o)}else{const e=document.createElement("base");e.href=t,o.getElementsByTagName("head")[0].appendChild(e)}}const r=undefined,s=Array.from(o.getElementsByTagName("script")).map((e=>{const n=""===e.src,o="module"===e.type,r=!n&&(Ce(e.src)?e.src:be(t,e.src)),s=n?"processed":"replaced";return Ae(e,Ee("script",n?"inline":e.src,s)),{module:o,type:n?"inline":"external",content:n?o&&t?Le(e.text,t):e.text:r}})),a=Array.from(o.getElementsByTagName("style")),i=Array.from(o.getElementsByTagName("link")).filter((e=>!e.rel||e.rel.includes("stylesheet"))),c=[...a.map((e=>(Ae(e,Ee("style","inline","replaced")),{type:"inline",content:e.innerText}))),...i.map((e=>(Ae(e,Ee("link",e.href,"processed")),{type:"external",content:Ce(e.href)?e.href:be(t,e.href)})))];if(t){const e=o.getElementsByTagName("base");for(let t=0;t<e.length;++t)null==(n=e[t])||n.parentNode.removeChild(e[t])}return{html:o.getElementsByTagName("html")[0],assets:{jsList:s,cssList:c}}}async function Ie({root:e,entry:t,entryContent:n,assetsCacheKey:o,href:r=location.href,fetch:s=ve}){const a=ye[o];let i=n;if(console.log("entry>>",t),!a){if(!i&&t){if(!s)throw pe.warn("Current environment does not support window.fetch, please use custom fetch"),new Error(`fetch ${t} error: Current environment does not support window.fetch, please use custom fetch`);i=await s(t).then((e=>e.text())),console.log("htmlContent>>",i)}ye[o]=i}const{html:c,assets:l}=je(a||i,t||r);return console.log("html>>",c),console.log("assets>>",l),e&&e.appendChild(c),l}const Se=()=>{const[e,o]=t.exports.useState(1),[r,s]=t.exports.useState(!1);let a=null;const i=t.exports.useMemo((async()=>e+2),[e]),c=async()=>await i,l=()=>{o(10)},u=async()=>{Ie({entry:"http://localhost:8080"});let e=await c();console.log("res",e)},d={name:"moduleName",url:["http://localhost:8080/runtime.bundle.js","http://localhost:8080/index.bundle.js"]};return t.exports.useEffect((()=>{console.log("moduleVisible",r),r?D(d,a,{},!0):q(d,a)}),[r]),t.exports.useEffect((()=>{D(d,a,{},!0)}),[]),n.exports.jsxs("div",{children:[n.exports.jsx("div",{ref:e=>{a=e}}),e,n.exports.jsx("button",{onClick:()=>l(),children:"\u6309\u6211"}),n.exports.jsx("button",{onClick:()=>u(),children:"\u83b7\u53d6\u5f02\u6b65\u6570\u636e"}),n.exports.jsx("button",{onClick:()=>{s(!r)},children:"\u5c55\u793a/\u9690\u85cf"})]})};export{Se as default};
